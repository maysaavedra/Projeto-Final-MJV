package com.mjv.projetofinal.service;

import java.io.File;
import java.io.IOException;
import java.util.Iterator;
import java.util.List;

import javax.servlet.ServletException;
import javax.servlet.ServletRequest;
import javax.servlet.annotation.WebServlet;
import javax.servlet.http.HttpServlet;
import javax.servlet.http.HttpServletRequest;
import javax.servlet.http.HttpServletResponse;

import org.apache.tomcat.util.http.fileupload.FileItem;
import org.apache.tomcat.util.http.fileupload.FileItemFactory;
import org.apache.tomcat.util.http.fileupload.FileUploadException;
import org.apache.tomcat.util.http.fileupload.RequestContext;
import org.apache.tomcat.util.http.fileupload.disk.DiskFileItemFactory;
import org.apache.tomcat.util.http.fileupload.servlet.ServletFileUpload;

	@SuppressWarnings("serial")
	@WebServlet("/UploaderImage")
	public class UploaderImage extends HttpServlet 
	{
		/**
		 * 
		 */
		


		protected void service(HttpServletRequest request,
				HttpServletResponse response) throws ServletException, IOException 
		{
			boolean isMultipart = ServletFileUpload.isMultipartContent(request);

			if (isMultipart) 
			{
				processarUpload(request);
			}
		}

		
		private void processarUpload(ServletRequest request)
		{
			String dirImgs = "/home/victor/";
			String nomeDoArq;
			
			FileItemFactory factory = new DiskFileItemFactory();

			ServletFileUpload upload = new ServletFileUpload(factory);

			try 
			{
				List items = upload.parseRequest(request);
				Iterator iterator = items.iterator();
				
				while (iterator.hasNext()) 
				{
					FileItem item = (FileItem) iterator.next();
					if (!item.isFormField()) 
					{
						nomeDoArq = item.getName();
						
						File path = new File(dirImgs);

						File uploadedFile = new File(path+"/"+nomeDoArq);
						System.out.println( uploadedFile.getAbsolutePath() );
						item.write(uploadedFile);
					}
				}
			} 
			catch (FileUploadException e) 
			{
				e.printStackTrace();
			} 
			catch (Exception e) 
			{
				e.printStackTrace();
			}
		}
	}